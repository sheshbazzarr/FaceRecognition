"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6113],{24939:(e,t,a)=>{a.d(t,{B:()=>c});var s=a(14041),r=a(50877),i=a(64225),n=a(87747),o=a(5933),l=a(36661);let c=()=>{let{editor:e}=(0,l.m)(),t=null==e?void 0:e.gammaDocId,{updateDocThemeWithAccentImages:a}=(0,n.Kt)({docId:t,editor:e}),c=(0,i.GV)(o.r2),d=(0,s.useCallback)(e=>c===e,[c]),m=(0,r.H4n)();return{setThemeWithAccentImages:a,isThemeApplied:d,currentThemeId:c,isValidTheme:(0,s.useCallback)(async e=>{try{let{data:t}=await m.query({query:r.xAr,variables:{id:e},returnPartialData:!1});return(null==t?void 0:t.theme)!==null}catch(e){return console.warn("[useThemeModificationController.isValidTheme] Error checking if theme is valid",e),!1}},[m])}}},50047:(e,t,a)=>{a.d(t,{Er:()=>o,H1:()=>l,VG:()=>c});var s=a(14041),r=a(87064),i=a(50877),n=a(65998);let o=e=>{let t=(0,n.u)("openAiStatus"),[a,i]=(0,s.useState)("input"),[o,l]=(0,s.useState)(e),[c,d]=(0,s.useState)();return{step:a,setStep:i,generateFormat:o,setGenerateFormat:l,selectedTheme:c,openAiStatus:t,setSelectedTheme:d,interactionId:(0,s.useMemo)(()=>(0,r.$F)(),[])}},l=()=>{let{data:e,loading:t}=(0,i.Snx)({variables:{workspaceId:null,archived:!1},fetchPolicy:"cache-first",nextFetchPolicy:"cache-only"});return{themes:(0,s.useMemo)(()=>(null==e?void 0:e.themes)||[],[e]),isThemesLoading:t}},c=()=>(0,n.u)("azureOpenAI")?i.eON.Azure:i.eON.Openai},66113:(e,t,a)=>{a.d(t,{XC:()=>eC,Mf:()=>ew,yn:()=>eb});var s=a(31085),r=a(25420),i=a(35687),n=a(75669),o=a(14041),l=a(71197),c=a(61778),d=a(80853),m=a(15672),g=a(18651),p=a(52177),u=a(39286),h=a(64225),f=a(77256),y=a(56897),x=a(33e3),k=a(8723),I=a(32202),b=a(62313),w=a(18201),v=a(74727),C=a(9021),j=a(27559),R=a(63633),S=a(20501),E=a(24221),A=a(95986),T=a(12327),M=a(10458);let _=(0,o.memo)(e=>{let{message:t}=e,a=(0,I.d)(),r=(0,M.st)(),{scrollToBottom:n}=eb(),l=(0,o.useRef)(null),[c,m]=(0,o.useState)(!1),[g,u]=(0,o.useState)(null);(0,o.useEffect)(()=>{if(c){var e;null===(e=l.current)||void 0===e||e.focus(),null==n||n()}},[c,n,r]);let h=t.interactionId,f=t.type,y=(0,o.useCallback)(e=>{u(e),m(!0),null==r||r.track(M.VV.AI_SUGGESTION_FEEDBACK,{interactionId:h,rating:e,type:f})},[r,h,f]),x=(0,o.useCallback)(()=>{var e;m(!1),null==r||r.track(M.VV.AI_SUGGESTION_FEEDBACK,{interactionId:h,rating:g,type:f,feedback:null===(e=l.current)||void 0===e?void 0:e.value}),l.current&&(l.current.value=""),a({title:(0,s.jsx)(p.x6,{id:"d6N994"}),description:(0,s.jsx)(p.x6,{id:"s/fQ3s"}),status:"success",duration:5e3,isClosable:!0})},[a,r,h,g,f]);return(0,s.jsxs)(i.B,{width:"100%",children:[(0,s.jsxs)(b.z,{children:[(0,s.jsx)(w.h,{}),(0,s.jsxs)(v.e,{size:"xs",variant:"ghost",colorScheme:"blackAlpha",children:[(0,s.jsx)(A.Tz,{label:(0,s.jsx)(p.x6,{id:"kR82DG"}),placement:"top",children:(0,s.jsx)(C.K,{"aria-label":"thumbs down",color:"poor"===g?"red.600":void 0,borderWidth:"1px",borderColor:"poor"===g?"red.600":"transparent",bg:"poor"===g?"red.100":void 0,_hover:{bg:"poor"===g?"red.200":"blackAlpha.100"},icon:(0,s.jsx)(E.g,{icon:S.lS9}),onClick:()=>{y("poor")}})}),(0,s.jsx)(A.Tz,{label:(0,s.jsx)(p.x6,{id:"y1GvbS"}),placement:"top",children:(0,s.jsx)(C.K,{"aria-label":"thumbs up",color:"good"===g?"green.600":void 0,borderWidth:"1px",borderColor:"good"===g?"green.600":"transparent",bg:"good"===g?"green.100":void 0,_hover:{bg:"good"===g?"green.200":"blackAlpha.100"},icon:(0,s.jsx)(E.g,{icon:S.Wcv}),onClick:()=>{y("good")}})})]})]}),(0,s.jsx)(j.S,{in:c,children:(0,s.jsxs)(i.B,{children:[(0,s.jsx)(R.T,{ref:l,bg:"white",size:"sm",placeholder:T.Ru._({id:"ZVGh9y"})}),(0,s.jsxs)(v.e,{children:[(0,s.jsx)(w.h,{}),(0,s.jsx)(d.$,{onClick:()=>m(!1),size:"xs",variant:"ghost",colorScheme:"blackAlpha",children:(0,s.jsx)(p.x6,{id:"6Uau97"})}),(0,s.jsx)(d.$,{onClick:x,size:"xs",variant:"plain",children:(0,s.jsx)(p.x6,{id:"RoafuO"})})]})]})})]})});_.displayName="SuggestionFeedback";let D=(0,o.memo)(e=>{let{message:t,editor:a}=e,r=t.suggestions.slice(0,1),n=(0,h.jL)(),l=(0,h.CU)(),I=(0,o.useCallback)(()=>(0,y.Lt)(l.getState()),[l]),b=(0,o.useCallback)(e=>{let t={timestamp:Date.now(),...e};n((0,y.tj)({message:t}))},[n]),{sendMessage:w}=(0,x.g)({addMessage:b,getMessageHistory:I,editor:a});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.q,{children:(0,s.jsxs)(i.B,{align:"start",children:[(0,s.jsx)(c.E,{children:(0,s.jsx)(p.x6,{id:"A9MA7Q",components:{0:(0,s.jsx)(d.$,{variant:"link",onClick:()=>{w({message:t.message||""})}})}})}),(0,s.jsx)(c.E,{color:"gray.500",textAlign:"center",fontSize:"xs",children:(0,s.jsx)(p.x6,{id:"ygs5tU"})}),(0,s.jsx)(m.r,{columns:2,spacing:2,w:"100%",children:r.map(e=>(0,s.jsx)(g._,{src:e.attrs.src,onDragStart:()=>{a&&(0,f.fS)(a,{type:"image",attrs:e.attrs})},h:36,draggable:!0,w:"100%",borderRadius:"md",transitionDuration:"normal",transitionProperty:"common",objectFit:"cover",cursor:"grab",_hover:{shadow:"outline"}},e.attrs.src))}),(0,s.jsx)(_,{message:t})]})}),t.isFirstGenerationInSession&&(0,s.jsx)(k.q,{children:(0,s.jsx)(c.E,{children:(0,s.jsx)(p.x6,{id:"cszDVM",values:{GAMMA_ARTIFACT_PROPER_NOUN:u.TP}})})})]})});D.displayName="GenerateImage";var N=a(30358),O=a(2600),F=a(33704),P=a.n(F);let L=()=>[T.Ru._({id:"91gjMr"}),T.Ru._({id:"PHyjBQ"}),T.Ru._({id:"zhFV/H"}),T.Ru._({id:"4ReFRy"}),T.Ru._({id:"aepNQh"}),T.Ru._({id:"fr8euV"}),T.Ru._({id:"+TEOEl"}),T.Ru._({id:"gQIRQv"}),T.Ru._({id:"pbDMHv"}),T.Ru._({id:"LP7cSD"}),T.Ru._({id:"ugneAh"})],U=()=>[T.Ru._({id:"DZ/eyq"}),T.Ru._({id:"S2U0+k"}),T.Ru._({id:"YZJ7kT"}),T.Ru._({id:"fLq3m1"}),T.Ru._({id:"1nrH2R"})],G=e=>{let{sendMessage:t}=e,[a]=(0,o.useState)(P()(L(),4).concat(P()(U(),2)));return(0,s.jsx)(O.T,{spacing:2,align:"flex-start",children:a.map((e,a)=>(0,s.jsx)(d.$,{variant:"unstyled",bg:"white",borderRadius:"md",size:"sm",px:2,border:"1px solid",borderColor:"gray.200",color:"orchid.400",fontWeight:"500",_hover:{bg:"trueblue.50",color:"trueblue.700"},onClick:()=>{t(e)},children:e},a))})},z=e=>({from:"Designer",type:"text",message:T.Ru._({id:"q65R55",values:{userName:e}}),timestamp:Date.now()}),q=e=>{let{sendMessage:t,hideSuggestions:a=!1}=e,{user:r}=(0,N.ur)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.q,{from:"Designer",children:z(null==r?void 0:r.firstName).message}),!a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.E,{color:"gray.500",fontSize:"sm",children:(0,s.jsx)(p.x6,{id:"MVir6z"})}),(0,s.jsx)(G,{sendMessage:t})]})]})};var H=a(70323),V=a(80532),B=a(55148),W=a(3040),J=a(24939),K=a(40408),Y=a(5933),Q=a(52014),$=a(12784),Z=a.n($);function X(e,t,a){var s;return null!==(s=a.find(a=>a.modification.isApplied(e,t)))&&void 0!==s?s:null}function ee(e,t){let a=(0,h.GV)(Y.SJ),s=(0,J.B)(),[r,i]=(0,o.useState)(()=>e?X(e,s,t):null),n=(0,o.useCallback)(()=>{e&&i(X(e,s,t))},[e,t,s]);return(0,o.useEffect)(()=>{if(!e)return;let a=Z()(()=>{i(X(e,s,t))},1e3);return e.on("update",a),()=>{e.off("update",a)}},[e,t,s]),(0,o.useEffect)(()=>{n()},[n,a]),{activeSuggestion:r,forceUpdate:n}}let et=(0,o.memo)(e=>{let{message:t,editor:a}=e,r=(0,Q.O)(),n=(0,J.B)(),{activeSuggestion:l,forceUpdate:d}=ee(a,t.suggestions),m=(0,o.useCallback)(e=>{a&&(r.trackSuggestionApplied({interactionId:t.interactionId,suggestionType:e.type,suggestionLabel:e.description,suggestionContent:e.getContentForTracking()}),e.apply(a,n),d())},[a,d,t.interactionId,n,r]);return a?(0,s.jsx)(k.q,{children:(0,s.jsxs)(i.B,{divider:(0,s.jsx)(H.c,{borderColor:"blackAlpha.200"}),children:[(0,s.jsx)(c.E,{children:t.message||"How's this?"}),t.suggestions.map((e,t)=>(0,s.jsx)(ea,{isSelected:e.label===(null==l?void 0:l.label),jsonContentPreview:e.jsonContentPreview,label:e.label,modification:e.modification,onClick:()=>{m(e.modification)}},t)),(0,s.jsx)(_,{message:t})]})}):null});et.displayName="SuggestContent";let ea=e=>{let{label:t,modification:a,jsonContentPreview:i,isSelected:n,onClick:l}=e,d=(0,h.GV)(Y.SJ);console.debug("[".concat(t,"] jsonContentPreview"),i,a);let m=(0,o.useCallback)(()=>{n||l()},[n,l]);return(0,s.jsxs)(b.z,{onClick:m,cursor:"pointer",px:2,py:1,borderRadius:"xl",_hover:{bg:"blackAlpha.100"},bg:n?"whiteAlpha.600":void 0,transitionProperty:"common",transitionDuration:"normal",spacing:4,children:[i&&(0,s.jsx)(r.s,{sx:{"mask-image":"linear-gradient(to bottom, black 75%, transparent 100%)"},children:(0,s.jsx)(r.s,{sx:K.o,justifyContent:"center",alignItems:"top",width:"150px",h:16,children:(0,s.jsx)(V.az,{transformOrigin:"top",transform:"scale(0.15)",pointerEvents:"none",children:(0,s.jsx)(K.S,{content:i,theme:d})})})}),(0,s.jsx)(c.E,{flex:1,fontSize:"sm",children:t}),(0,s.jsx)(B.J,{in:n,children:(0,s.jsx)(E.g,{icon:W.e68,fixedWidth:!0})})]})};var es=a(82438),er=a.n(es),ei=a(952),en=a(17539);let eo=(0,o.memo)(e=>{let{message:t,editor:a}=e,r=t.suggestions.slice(0,8),n=er()(r.map(e=>{let{query:t}=e;return t})),o=0===n.length?T.Ru._({id:"QICyFn"}):1==n.length?T.Ru._({id:"x/YBq7",values:{0:n[0].toLowerCase()}}):2==n.length?T.Ru._({id:"Tn1hkb",values:{0:n[0].toLowerCase(),1:n[1].toLowerCase()}}):T.Ru._({id:"Z918ro",values:{0:n[0].toLowerCase(),1:n[1].toLowerCase(),2:n[2].toLowerCase()}});return(0,s.jsx)(k.q,{children:(0,s.jsxs)(i.B,{align:"start",children:[(0,s.jsxs)(c.E,{children:[o," ",(0,s.jsx)(p.x6,{id:"CvUN7V"})]}),(0,s.jsx)(c.E,{color:"gray.500",textAlign:"center",fontSize:"xs",children:(0,s.jsx)(p.x6,{id:"fg3FfA"})}),(0,s.jsx)(m.r,{columns:2,spacing:2,w:"100%",children:r.map(e=>{let{image:t,query:r,provider:i}=e,n=(0,en.Ub)(t.thumbnailUrl,{width:250,height:250});return(0,s.jsx)(g._,{src:n,fallbackSrc:t.thumbnailUrl,onDragStart:()=>{a&&(0,f.fS)(a,{type:"image",attrs:(0,ei.TF)(t,r,i)})},h:24,draggable:!0,w:"100%",borderRadius:"md",transitionDuration:"normal",transitionProperty:"common",objectFit:"cover",cursor:"grab",_hover:{shadow:"outline"}},t.id)})}),(0,s.jsx)(_,{message:t})]})})});eo.displayName="SuggestImage";let el=e=>e.replace(/(<([^>]+)>)/gi,""),ec=(0,o.memo)(e=>{let{message:t,editor:a}=e,r=(0,Q.O)(),i=(0,J.B)(),{activeSuggestion:n,forceUpdate:o}=ee(a,t.suggestions);return(0,s.jsx)(k.q,{from:t.from,children:(0,s.jsxs)(O.T,{spacing:2,align:"start",children:[(0,s.jsx)(c.E,{children:t.message||"Here are some ideas:"}),t.suggestions.map((e,l)=>(0,s.jsx)(ed,{value:e,isSelected:e===n,onClick:()=>{if(!a)return;let{modification:s}=e;r.trackSuggestionApplied({interactionId:t.interactionId,suggestionType:s.type,suggestionLabel:s.description,suggestionContent:s.getContentForTracking()}),s.apply(a,i),o()}},l)),(0,s.jsx)(_,{message:t})]})})}),ed=e=>{let{value:t,isSelected:a,onClick:r}=e,i=(0,o.useCallback)(()=>{a||r()},[a,r]);return(0,s.jsxs)(b.z,{onClick:i,cursor:"pointer",p:4,borderRadius:"xl",_hover:{bg:"whiteAlpha.600"},bg:"white",transitionProperty:"common",transitionDuration:"normal",spacing:4,shadow:"md",align:"start",children:[(0,s.jsxs)(V.az,{children:[(0,s.jsx)(c.E,{fontSize:"sm",color:"gray.500",children:t.reason}),(0,s.jsx)(c.E,{fontSize:"sm",noOfLines:3,children:el(t.value)})]}),(0,s.jsx)(B.J,{in:a,children:(0,s.jsx)(E.g,{icon:W.e68,fixedWidth:!0})})]})};ec.displayName="SuggestText";var em=a(88085),eg=a(87747),ep=a(55575);let eu=(0,o.memo)(e=>{let{message:t,editor:a}=e,{onClose:r}=eb(),n=(0,Q.O)(),l=(0,J.B)(),{activeSuggestion:m}=ee(a,t.suggestions),g=(0,o.useCallback)(e=>{a&&(n.trackSuggestionApplied({interactionId:t.interactionId,suggestionType:t.type,suggestionLabel:e.description,suggestionContent:e.getContentForTracking()}),e.apply(a,l))},[a,n,t,l]);return(0,s.jsx)(k.q,{children:(0,s.jsxs)(i.B,{children:[(0,s.jsx)(c.E,{children:t.message}),t.suggestions.map(e=>{let{themeId:t,label:a,isOriginal:r}=e;return(0,s.jsxs)(o.Fragment,{children:[r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(H.c,{borderColor:"blackAlpha.200"}),(0,s.jsxs)(c.E,{children:[a,": "]})]}),(0,s.jsx)(eh,{themeId:t,onClick:()=>g(e.modification),isSelected:(null==m?void 0:m.themeId)===t})]},t)}),(0,s.jsx)(c.E,{children:(0,s.jsx)(p.x6,{id:"eVMeEi"})}),(0,s.jsx)(d.$,{leftIcon:(0,s.jsx)(E.g,{icon:S.fyG}),w:"100%",onClick:()=>{r(),ep.R.emit("toggleThemeBlock",!0)},children:(0,s.jsx)(p.x6,{id:"ni+gIz"})}),(0,s.jsx)(_,{message:t})]})})});eu.displayName="SuggestThemes";let eh=(0,o.memo)(e=>{let{themeId:t,onClick:a,isSelected:r}=e,i=(0,eg.Lb)(t);return"new"===i.id?null:(0,s.jsxs)(O.T,{onClick:a,cursor:"pointer",p:2,borderRadius:"xl",_hover:{bg:"blackAlpha.100"},bg:r?"whiteAlpha.600":void 0,transitionProperty:"common",transitionDuration:"normal",children:[(0,s.jsx)(V.az,{borderRadius:"lg",overflow:"hidden",w:"100%",children:(0,s.jsx)(em.q,{theme:i,variant:"outline"})}),(0,s.jsxs)(b.z,{alignSelf:"flex-start",color:r?"trueblue.700":void 0,children:[(0,s.jsx)(B.J,{in:r,unmountOnExit:!0,children:(0,s.jsx)(E.g,{icon:W.e68,fixedWidth:!0})}),(0,s.jsx)(c.E,{fontSize:"sm",fontWeight:r?"semibold":void 0,children:i.name})]})]})});eh.displayName="ThemeMessageThumbnailPreview";var ef=a(69237),ey=a(3706);let ex=(0,o.memo)(e=>{let{message:t,sendMessage:a}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.q,{children:t.message&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(c.E,{children:[(0,s.jsx)("span",{className:"emoji",role:"img","aria-label":"sorry",children:"\uD83D\uDE14"})," ",t.message," ",t.learnMoreLink&&(0,s.jsxs)(ey.N,{href:t.learnMoreLink,textDecoration:"underline",isExternal:!0,children:["Learn more ",(0,s.jsx)(ef.p,{mx:"2px",fontSize:"sm"})]})]})})}),(0,s.jsx)(c.E,{color:"gray.500",fontSize:"sm",children:"Here are some other things I can do:"}),(0,s.jsx)(G,{sendMessage:a})]})});ex.displayName="UnsupportedTask";let ek=(0,o.memo)(e=>{let{message:t}=e;return(0,s.jsx)(k.q,{warning:t.warning,from:t.from,children:t.message})});ek.displayName="UserDesignerMessage";let eI=o.createContext({scrollToBottom:()=>{},onClose:()=>{}}),eb=()=>o.useContext(eI),ew=e=>{let{messages:t,scrollSelector:a,editor:c,sendMessage:d,isLoading:m,onClose:g}=e,{hasEnoughCreditsToChat:p,isCreditsReady:u}=(0,l.B9)(),h=(0,o.useCallback)(()=>{let e=a&&document.querySelector(a);e&&setTimeout(()=>{requestAnimationFrame(()=>{e.scrollTo({top:e.scrollHeight,behavior:"smooth"})})},400)},[a]),f=(0,o.useRef)({scrollToBottom:h,onClose:g});return f.current.scrollToBottom=h,(0,s.jsx)(eI.Provider,{value:f.current,children:(0,s.jsx)(r.s,{flex:1,flexDirection:"column",justifyContent:"flex-end",children:(0,s.jsx)(i.B,{pt:12,spacing:2,children:(0,s.jsxs)(n.N,{children:[(0,s.jsx)(q,{sendMessage:d,hideSuggestions:u&&!p}),t.map(e=>{if("text"===e.type)return(0,s.jsx)(ek,{message:e},e.timestamp);if("suggestImages"===e.type)return(0,s.jsx)(eo,{message:e,editor:c},e.timestamp);if("generateImage"===e.type)return(0,s.jsx)(D,{message:e,editor:c},e.timestamp);if("suggestText"===e.type)return(0,s.jsx)(ec,{message:e,editor:c},e.timestamp);if("suggestThemes"===e.type)return(0,s.jsx)(eu,{message:e,editor:c},e.timestamp);if("suggestContent"===e.type)return(0,s.jsx)(et,{message:e,editor:c},e.timestamp);if("unsupported"===e.type)return(0,s.jsx)(ex,{message:e,sendMessage:d},e.timestamp);return console.warn("[MessageList] Message type not found",e),null}),m&&(0,s.jsx)(ev,{},"loading")]})})})})},ev=()=>(0,s.jsx)(k.q,{from:"Designer",children:(0,s.jsx)(eC,{})}),eC=()=>(0,s.jsxs)(r.s,{className:"bouncing-loader",justify:"center",children:[(0,s.jsx)("div",{}),(0,s.jsx)("div",{}),(0,s.jsx)("div",{})]})},52014:(e,t,a)=>{a.d(t,{O:()=>o});var s=a(14041),r=a(87064),i=a(64225),n=a(47078);let o=()=>{let e=(0,i.CU)(),t=(0,i.jL)(),a=(0,s.useCallback)((e,a)=>{t((0,n.F1)({taskContext:e,provider:a})),(0,r.rl)({interactionId:e.interactionId,interface:"chat",inputMessage:e.message,docId:e.docId,cardId:e.editorContext.card.cardId,provider:a})},[t]),o=(0,s.useCallback)(e=>{t((0,n.Q6)(e))},[t]),l=(0,s.useCallback)(e=>{t((0,n.lb)(e))},[t]),c=(0,s.useCallback)(a=>{t((0,n.G8)(a));let{taskContext:s}=a,i=(0,n.SY)(s.interactionId)(e.getState());if(!i){console.error("[trackRequestComplete] no data found for interactionId",s.interactionId);return}(0,r.UL)({interactionId:s.interactionId,interface:"chat",docId:s.docId,cardId:i.cardId,classification:i.classification,provider:i.provider,inputMessage:s.message,inputContent:i.inputContent,rawResponse:a.resp,outputMessage:i.outputMessage,outputContent:i.outputContent,latency:performance.now()-s.startTime,timeToComplete:performance.now()-s.startTime})},[t,e]),d=(0,s.useCallback)(t=>{let{outputMessage:a,errorMessage:s,errorCode:i,interactionId:o,resp:l,errorName:c}=t,d=(0,n.SY)(o)(e.getState());if(!d){console.error("[trackRequestError] no data found for interactionId",o);return}(0,r.tB)({interactionId:o,interface:"chat",docId:d.docId,cardId:d.cardId,classification:d.classification,provider:d.provider,inputMessage:d.message,inputContent:d.inputContent,outputMessage:a,errorName:c,errorMessage:s,errorCode:i,rawResponse:l,latency:performance.now()-d.startTime})},[e]),m=(0,s.useCallback)(t=>{let{interactionId:a,retriesRemaining:s,resp:i}=t,o=(0,n.SY)(a)(e.getState());if(!o){console.error("[trackRequestRetry] no data found for interactionId",a);return}(0,r.zA)({interactionId:a,interface:"chat",classification:o.classification,docId:o.docId,cardId:o.cardId,provider:o.provider,inputMessage:o.message,inputContent:o.inputContent,rawResponse:i,retriesRemaining:s})},[e]),g=(0,s.useCallback)(t=>{let{interactionId:a,suggestionContent:s,suggestionType:i,suggestionLabel:o,autoApplied:l}=t,c=(0,n.SY)(a)(e.getState());if(!c){console.error("[trackSuggestionApplied] no data found for interactionId",a);return}let d="string"==typeof s?s:"html"===s.type?s.html:"json"===s.type?s.json:void 0;(0,r.hj)({interactionId:a,interface:"chat",docId:c.docId,cardId:c.cardId,classification:c.classification,provider:c.provider,inputMessage:c.message,inputContent:c.inputContent,outputMessage:c.outputMessage,outputContent:c.outputContent,suggestionType:i,suggestionLabel:o,suggestionContent:d,autoApplied:!!l})},[e]);return(0,s.useMemo)(()=>({trackClassification:o,trackRequestComplete:c,trackInputContent:l,trackRequestSent:a,trackRequestError:d,trackRequestRetry:m,trackSuggestionApplied:g}),[o,l,c,a,d,m,g])}},8723:(e,t,a)=>{a.d(t,{q:()=>m});var s=a(31085),r=a(25420),i=a(56824),n=a(90290),o=a(69648),l=a(11395),c=a(65513);let d=(0,a(60674).P)(r.s),m=e=>{let{children:t,from:a="Designer",warning:r=!1,cardStyleOverrides:m,error:g=!1,...p}=e,u=(0,i.dU)("orchid.400","blue.700"),h=(0,i.dU)("trueblue.50","sunglow.700"),f=(0,i.dU)("red.100","red.500"),y="User"===a,x=y?{bg:u,borderBottomRightRadius:0,color:"white",...m}:{bg:r?void 0:g?f:h,borderBottomLeftRadius:0,...m};return(0,s.jsx)(d,{justify:y?"flex-end":"flex-start",initial:{opacity:0,translateX:-20},animate:{opacity:1,translateX:0},...p,children:r?(0,s.jsxs)(n.F,{status:"warning",borderColor:"orange.200",borderWidth:"1px",fontSize:"inherit",...x,children:[(0,s.jsx)(o._,{}),t]}):(0,s.jsx)(l.Z,{size:"sm",shadow:"sm",borderRadius:"xl",variant:"filled",minH:0,borderColor:g?"red.200":"blackAlpha.200",...x,children:(0,s.jsx)(c.b,{py:2,px:2,children:t})})})}},33e3:(e,t,a)=>{a.d(t,{g:()=>eJ});var s=a(56154),r=a(14041),i=a(83603),n=a(81768),o=a(50877),l=a(89049),c=a(57450),d=a(32899),m=a(46645),g=a(57624);class p extends l.a{async runPrompt(e){let{input:t,context:a,variables:s,trackFns:r,retries:n=2}=e,o=await (0,c.U)(t,a.interactionId,{timeout:d.of.get("aiRequestTimeouts").basicReply});if(!o)throw Error("Couldn't get response from prompt");if((0,m.t)(o)||(null==o?void 0:o.includes("```"))){if(n<=0)throw new i.K$("Did not receive proper response after retries",{chatMessage:"Sorry, I am having trouble understanding. Could you try asking in a different way?",inputMessage:a.message,resp:o,interactionId:a.interactionId});return r.trackRequestRetry({interactionId:a.interactionId,retriesRemaining:n,resp:o}),this.runPrompt({input:t,context:a,variables:s,trackFns:r,retries:n-1})}return o}async run(e){let{context:t,addMessage:a,history:s,trackFns:r,provider:i}=e,n={message:t.message},o=(0,g.K)(s||[]),l=this.prompt.prepare({variables:n,history:o,params:{provider:i},interactionId:t.interactionId}),c=await this.runPrompt({input:l,context:t,variables:n,trackFns:r,retries:1});r.trackRequestComplete({taskContext:t,outputMessage:c}),a({from:"Designer",type:"text",message:c,resp:c,interactionId:t.interactionId})}constructor(e){super(e),this.prompt=e.prompt}}let u=[new p({key:"CHAT",description:"A general chat message, or a request that doesn't fit any of the previous categories",classifyExamples:["hi how are you","hdfoho;safjw","help there are bees everywhere","great job!","this looks ugly"],prompt:new n.F({systemPromptOperation:o.mc.BasicReplyChatSystem,userPromptOperation:o.mc.BasicReplyChatUser,variables:["message"],params:{maxTokens:150,temperature:0}})})],h=e=>u.find(t=>t.key===e),f=e=>!!u.find(t=>t.key===e);var y=a(25465),x=a(65449),k=a(65998),I=a(87064),b=a(20221),w=a(55864),v=a(57882);class C extends l.a{async run(e){let{addMessage:t,context:a,trackFns:s,history:r}=e,i=performance.now(),n=w.V.prepare({variables:{input:a.message,html:a.editorContext.cardContent.html}}),o=await (0,c.U)(n,a.interactionId);if(!o)throw Error("Couldn't get response from prompt");let l={prompt:o,count:1,model:k.of.get("aiGeneratedImagesDefaultModel")},d=b.Rz[l.model],m={interactionId:a.interactionId,interface:"generate-image",provider:d.provider,streaming:!1,inputContent:o,docId:a.docId,generateImageOptions:l};try{var g;(0,I.rl)(m);let e=null===(g=(0,v.bs)())||void 0===g?void 0:g.id,n=await (0,b.hU)({interactionId:a.interactionId,docId:a.docId,workspaceId:e,...l});if(0===n.length)throw Error("No images generated");t({from:"Designer",type:"generateImage",suggestions:n,interactionId:a.interactionId,isFirstGenerationInSession:!r||!r.some(e=>"generateImage"===e.type),message:a.message}),(0,I.Yh)({...m,latency:performance.now()-i,generateImageUrls:n.map(e=>e.attrs.src)}),s.trackRequestComplete({taskContext:a,outputContent:JSON.stringify(n),outputMessage:""})}catch(e){console.error("(caught) [AIGenerateImage] error:",e),(0,I.tB)({...m,latency:performance.now()-i,errorName:"GenerateImageError",errorMessage:e.message,outputMessage:""})}}constructor(e){super(e)}}let j=[new C({key:"GENERATE_IMAGE",description:"Generate an image using AI.",classifyExamples:["generate an image of a panda eating starbursts","add an AI image that shows people talking and working","use AI to make a picture of a laptop on a windowsill","generate an image of a watercolor painting of a flower vase"],classifyReply:"Sure, I'll generate an image of a panda..."})],R=e=>j.find(t=>t.key===e),S=e=>!!R(e);var E=a(21450),A=a(43125),T=a(46108),M=a.n(T),_=a(32262),D=a(77646),N=a(20277),O=a(72477);class F{isApplied(e){return!!(0,D.W0)(e,this.cardId)}getPreviewJson(e){let t=e.state.tr;this.transact(e,t);let a=M()(t.doc.toJSON());return(0,O.sT)(a,this.cardId)}apply(e){if(this.isApplied(e)){console.debug("[InsertCardModification] NOT applying modification, card already exists with cardId=".concat(this.cardId),{modification:this});return}let t=e.state.tr;this.transact(e,t),console.debug("[InsertCardModification] Applying modification",{modification:this}),e.view.dispatch(t),(0,_.OM)({editor:e,cardId:this.cardId})}transact(e,t){let a=(0,D.W0)(e,this.afterCardId);if(!a)return null;let s=(0,O.ni)(e,this.content),r=a.pos+a.node.nodeSize;t.insert(r,s.content.firstChild);let i=(0,N.s)(t.doc.resolve(r),1);return t.setSelection(i),{from:r,to:r+t.doc.nodeAt(r).nodeSize}}getContentForTracking(){return this.content}constructor(e){this.type="insert-card",this.description=e.description,this.cardId=e.cardId,this.afterCardId=e.afterCardId,this.content=e.content}}class P{isApplied(e){return!(0,D.W0)(e,this.cardId)}getPreviewJson(e){return null}apply(e){let t=e.state.tr,a=(0,D.W0)(e,this.cardId);a&&(t.delete(a.pos,a.pos+a.node.nodeSize),console.debug("[RemoveCardModification] Applying modification",{modification:this}),e.view.dispatch(t))}getContentForTracking(){return this.cardId}constructor(e){this.type="remove-card",this.description=e.description,this.cardId=e.cardId}}var L=a(24038);class U extends L.dV{async getResponseMessages(e){let{editor:t,context:a,response:{suggestion:s,message:r,raw:n}}=e;if(!s)throw new i.tF("No card content returned",{interactionId:a.interactionId,resp:n,chatMessage:r||(0,L.Fz)(),inputMessage:a.message});let o=(0,A.IZ)((0,A.lI)(t)),{aiOptions:l}=(0,A.lI)(t),c=null==l?void 0:l.imageOptions,d=await (0,E.Lm)(s,{loadImages:!0,docFormatKey:o.formatType,cardIndex:1,imageOptions:c||{provider:"web"},theme:a.editorContext.theme,context:{docId:a.docId,workspaceId:(0,v.gx)(),interactionId:a.interactionId}}),m=d.attrs.id,g=new F({description:"New Card",content:{type:"json",json:[d]},cardId:m,afterCardId:a.editorContext.card.cardId}),p={label:"New card",modification:g,jsonContentPreview:g.getPreviewJson(t)},u=new P({description:"Remove card",cardId:m}),h={label:"Remove card",modification:u,jsonContentPreview:u.getPreviewJson(t)},f={from:"Designer",type:"suggestContent",resp:n,message:r||"How about this?",suggestions:[p,h],interactionId:a.interactionId};return console.debug("[addCard]",{insert:p,remove:h,message:r,html:s,content:d}),{messages:[f],suggestionToApply:p}}}let G=new U({key:"ADD_CARD",description:"Add a new card after the current one",classifyExamples:["add a new slide","add a card describing our mission","i want a new section for leadership development","make another card","on a new card compare the two options in a table"],classifyReply:"Ok, I'll start writing a new card...",prompt:new n.F({systemPromptOperation:o.mc.AddCardSystem,userPromptOperation:o.mc.AddCardUser,variables:["html","message","outline"],params:{temperature:.7,maxTokens:1e3}})});var z=a(12327),q=a(3756);class H{isApplied(e){let t=(0,D.W0)(e,this.cardId);return t?t.node.attrs.layout===this.layout:(console.error("[SetCardLayoutModification.apply] Could not find card to update: ".concat(this.cardId,", maybe deleted")),!1)}getPreviewJson(e){let t=e.state.tr;this.transact(e,t);let a=M()(t.doc.toJSON()),s=(0,O.sT)(a,this.cardId);return console.debug("[SetCardLayoutModification.getPreviewJson] result",s),s}apply(e){if(this.isApplied(e)){console.debug("[SetCardLayoutModification] NOT applying modification, card already has layout=".concat(this.layout),{modification:this});return}let t=e.state.tr;this.transact(e,t),console.debug("[SetCardLayoutModification] Applying modification",{modification:this}),e.view.dispatch(t),(0,_.OM)({editor:e,cardId:this.cardId})}transact(e,t){let a=(0,D.W0)(e,this.cardId);if(!a){console.error("[SetCardLayoutModification.apply] Could not find card to update: ".concat(this.cardId,", maybe deleted"));return}(0,q.c)(e,t,a.pos,this.layout)}getContentForTracking(){return this.layout}constructor(e){this.type="set-card-layout",this.description=e.description,this.cardId=e.cardId,this.layout=e.layout}}let V=()=>z.Ru._({id:"ppX7+s"});class B extends L.dV{async getResponseMessages(e){let{editor:t,context:a,rangeId:s,response:{suggestion:r,raw:n,message:o}}=e;if(!r)throw new i.tF("No card layout returned",{resp:n,chatMessage:V(),inputMessage:a.message,interactionId:a.interactionId});if(!(0,D.pI)(r))throw console.error("Invalid card layout:",r),new i.tF("Invalid card layout: ".concat(r),{resp:n,chatMessage:V(),inputMessage:a.message,interactionId:a.interactionId});let l=new H({description:z.Ru._({id:"nyQWMb"}),cardId:a.editorContext.card.cardId,layout:r}),c={label:z.Ru._({id:"nyQWMb"}),modification:l,jsonContentPreview:l.getPreviewJson(t)},d=new H({description:z.Ru._({id:"HxF6Fk"}),cardId:a.editorContext.card.cardId,layout:a.editorContext.card.attrs.layout}),m={label:z.Ru._({id:"HxF6Fk"}),modification:d,jsonContentPreview:d.getPreviewJson(t)};return{messages:[{from:"Designer",type:"suggestContent",resp:n,message:o||z.Ru._({id:"pMSbe+"}),interactionId:a.interactionId,suggestions:[c,m]}],suggestionToApply:c}}}let W=new B({key:"MOVE_ACCENT_IMAGE",description:"Move or remove the accent image of the card. Use ADD_IMAGE to add accent images.",classifyExamples:["move the sand dune to the left","remove the cover photo"],classifyReply:"Ok, I will move the accent image to the left...",getTaskTarget:e=>e.card,prompt:new n.F({systemPromptOperation:o.mc.ChangeAccentImageLayoutSystem,userPromptOperation:o.mc.ChangeAccentImageLayoutUser,variables:["html","message"],params:{temperature:.2,maxTokens:100}}),checkEnabled:e=>"blank"!==e.card.attrs.layout}),J=new n.F({systemPromptOperation:o.mc.ChangeContentSystem,userPromptOperation:o.mc.ChangeContentUser,variables:["html","message","outline"],params:{temperature:.7,maxTokens:1e3}}),K=new L.dV({key:"CHANGE_CONTENT",description:"Rephrase, summarize, expand, change text formatting, add content, or express ideas differently.",classifyExamples:["condense this to just the key points","say this like a pirate","make this more formal","add a box about health benefits","add more text please","make the bullets red","make the text bigger","fill in the last  column","write something about ___","add ___ to the table"],classifyReply:"Ok, I'll try making it shorter...",prompt:J,jsxPrompt:"ChatChangeContent"});var Y=a(83190),Q=a(26917),$=a(88303),Z=a(952);let X=new n.F({systemPromptOperation:o.mc.RateImagesSystem,userPromptOperation:o.mc.RateImagesUser,variables:["dataset"],params:{temperature:.1,maxTokens:100}}),ee=async(e,t)=>{let a=e.map((e,t)=>{let{description:a,query:s}=e;return"".concat(t+1,": ").concat(a,": ").concat(s)}).join("\n"),s=X.prepare({variables:{dataset:a},history:[]});return(await (0,c.U)(s,t,{timeout:d.of.get("aiRequestTimeouts").rateImages})||"").split("\n").map(e=>{let[,t]=e.split("-");return Number(t.trim())})};class et extends L.dV{async getResponseData(e,t){let a=(await Promise.all(e.replaceAll(this.key,"").split("\n").map(async e=>{let t=e.split(",").map(e=>e.trim()).slice(0,2);return await (0,Q.r)({queries:t,count:$.s.count,provider:"web",prefetch:!0,options:{gammaFeature:"aiChat"}})}))).flat();console.debug("[SuggestImagesTask][getResponseData] allResults",a);let s=a.map(e=>{let{image:t,query:a}=e,s=(0,Z.TF)(t,a,"web");return{description:(0,Z.ve)(s)||"",query:a}});console.debug("[SuggestImagesTask][imageRatingData]",{imagesToRate:s});try{let e=await ee(s,t);if(console.debug("[SuggestImagesTask][imageRatingValues]",{imageRatingValues:e}),e.length!==a.length)throw Error("Image rating values length does not match allResults length");let r=a.map((t,a)=>({...t,rating:e[a]})).sort((e,t)=>t.rating-e.rating);return console.debug("[SuggestImagesTask][allResultsSorted]",{allResultsSorted:r}),r}catch(e){console.warn("[SuggestImagesTask] Error rating images. Returing unsorted results.",e)}return a}async getResponseMessages(e){let{context:t,response:{message:a,raw:s,suggestion:r}}=e;if(!r)throw new i.tF("No image results were returned",{resp:s,inputMessage:t.message,chatMessage:a||"I'm sorry, I wasn't able to find any images for this.",interactionId:t.interactionId});return{messages:[{from:"Designer",type:"suggestImages",suggestions:await this.getResponseData(r,t.interactionId),resp:s,interactionId:t.interactionId,message:a||"Here are some suggestions:"}]}}}let ea=new et({key:"ADD_IMAGE",description:"Add images, or replace an existing image. Do not use for moving or removing images.",classifyExamples:["add a picture of a bus","find some different images","this needs a pic","show me dolphins","find a meme of stonks","give me more images","add a background image","i need a graph of population over time"],classifyReply:"Let me look for some good bus pictures...",getTaskTarget:e=>e.defaultRange,prompt:new n.F({systemPromptOperation:o.mc.SuggestImagesSystem,userPromptOperation:o.mc.SuggestImagesUser,variables:["html","message"],params:{temperature:.7,maxTokens:500}})});var es=a(81570),er=a(44347);class ei extends L.dV{getResponseData(e){let t=[];for(let a of e.matchAll(/^\/\/\s*(.*)$\n(.*)$/gm)){let e=a[1],s=a[2];t.push({reason:e,value:s})}return t}async getResponseMessages(e){let{editor:t,context:a,rangeId:s,response:{suggestion:r,message:n,raw:o}}=e;if(!r)throw new i.tF("No suggestions found in response",{interactionId:a.interactionId,inputMessage:a.message,chatMessage:n||z.Ru._({id:"7KKeOM"})});let l=this.getResponseData(r).map(e=>{let a=new er.m(t,{description:e.reason,content:{type:"html",html:e.value},rangeId:s});return{...e,modification:a}}),c=this.determineTaskTarget(a.editorContext).html,d=new er.m(t,{description:z.Ru._({id:"HxF6Fk"}),content:{type:"html",html:c},rangeId:s}),m={reason:z.Ru._({id:"HxF6Fk"}),value:c,modification:d};return{messages:[{from:"Designer",type:"suggestText",message:n||z.Ru._({id:"3YHvwF"}),resp:o,suggestions:[...l,m],interactionId:a.interactionId}]}}}let en=new ei({key:"SUGGEST_TEXT",description:"Open-ended request to rephrase a sentence or paragraph",classifyExamples:["write a better headline","How else could i say this?","this feels too corporate","suggest a more engaging way to say this","give me a more interesting description"],classifyReply:"Let me think of some other headlines...",getTaskTarget:e=>e.selectionRange,prompt:new n.F({systemPromptOperation:o.mc.SuggestTextSystem,userPromptOperation:o.mc.SuggestTextUser,variables:["html","message"],params:{temperature:.7,maxTokens:1e3}}),checkEnabled(e){let{selection:t}=e,a=t instanceof es.U3,s=t.$from.parent.eq(t.$to.parent);return a&&!t.empty&&t.to-t.from<800&&s}});class eo{apply(e,t){t.setThemeWithAccentImages(this.themeId)}isApplied(e,t){return t.isThemeApplied(this.themeId)}getPreviewJson(){return null}getContentForTracking(){return this.themeId}constructor(e,t){this.type="change-theme",this.description=t.description,this.themeId=t.themeId}}class el extends L.dV{async getResponseMessages(e){let{editor:t,context:a,response:{raw:s,suggestion:r,message:n},themeModificationController:o}=e,{currentThemeId:l,isValidTheme:c}=o,d=null==r?void 0:r.split("\n"),m=await this.getFilteredSuggestions({ids:d,idToRemove:l,editor:t,isValid:c});if(0===m.length)throw new i.tF("[SuggestContentTask] No themes provided in prompt response",{resp:s,chatMessage:z.Ru._({id:"GNHk+9"}),inputMessage:a.message,interactionId:a.interactionId});let g={label:z.Ru._({id:"HxF6Fk"}),themeId:l,modification:new eo(t,{description:z.Ru._({id:"HxF6Fk"}),themeId:l}),isOriginal:!0};return{messages:[{from:"Designer",type:"suggestThemes",resp:s,message:n||z.Ru._({id:"pMSbe+"}),suggestions:[...m,g],interactionId:a.interactionId}],suggestionToApply:m[0]}}async getFilteredSuggestions(e){let{ids:t,idToRemove:a,editor:s,isValid:r}=e;return t&&0!==t.length?(await Promise.all(t.map(e=>r(e).then(t=>t?e:null)))).filter(e=>null!==e).filter(e=>e!==a).map(e=>{let t=new eo(s,{description:z.Ru._({id:"nyQWMb"}),themeId:e});return{label:z.Ru._({id:"nyQWMb"}),themeId:e,modification:t}}):[]}}let ec=new el({key:"SUGGEST_THEME",description:"Suggest a theme for the deck. This task will suggest themes based on the deck content or the prompt",classifyExamples:["change the theme","give me a blue theme","change the color palette","make this a dark theme","use a more colorful theme","let's change the look and the feel","change the theme to lilac and periwinkle","i'd like it to look more cheerful and welcoming"],classifyReply:"Let me find some themes...",prompt:new n.F({systemPromptOperation:o.mc.SuggestThemeSystem,userPromptOperation:o.mc.SuggestThemeUser,variables:["html","message","outline"],params:{temperature:.7,maxTokens:100,model:"gpt-4-1106-preview"}})}),ed=[W,Y.t,K,en,ea,G,ec],em=e=>ed.find(t=>t.key===e),eg=e=>!!ed.find(t=>t.key===e);class ep extends l.a{async run(e){let{classificationResult:t,addMessage:a,context:s,trackFns:r}=e;a({from:"Designer",type:"unsupported",task:t.classification,message:this.apology,learnMoreLink:this.apologyLink,resp:t.resp,interactionId:s.interactionId}),r.trackRequestComplete({taskContext:s,outputMessage:this.apology})}constructor(e){super(e),this.apology=e.apology,this.apologyLink=e.apologyLink}}let eu=new ep({key:"CHANGE_CARD_BACKGROUND",description:"Change the background of the entire section.",classifyExamples:["make the background red","put a tunnel in the background","remove the background","get rid of the image in the background"],apology:"Sorry, I can't change backgrounds yet, but you can click on a card and change the background yourself. You can also change the document background by clicking Page Setup located at the top left corner of the page."}),eh=new ep({key:"CHANGE_FONT",description:"Change the font family or font style.",classifyExamples:["give me a more playful font","make the headings use arial","change the font to be more readable"],apology:"Sorry, I can't change fonts yet. But you can edit them yourself by creating a custom theme.",apologyLink:"https://gamma.app/public/o2he6ual8noal7u#card-82e40n78edir2x8"}),ef=new ep({key:"RESIZE_IMAGE",description:"Change the size of an image (its dimensions), or crop an image",classifyExamples:["make the image smaller","can you make the cat bigger","crop it so it's just the face","I want the disposition of the photos for more portrait instead of landscape"],apology:"Sorry, I can't resize images yet. But you can do it yourself by clicking on the image and dragging the boxes on the corners, or pressing the crop button above the image."}),ey=new ep({key:"EDIT_IMAGE",description:"Edit the appearance of an image",classifyExamples:["make the image brighter","add a blue border to the image","make the image black and white","add a nice filter to the image"],apology:"Sorry, I can't edit images yet."}),ex=new ep({key:"EXPORT",description:"Export or download the deck into a different a format.",classifyExamples:["download as ppt","make a pdf","export to google slides"],apology:"Sorry, I can't export files yet. However, you can download a PDF yourself by using the Share menu."}),ek=new ep({key:"SPLIT_CARD",description:"Split a card into multiple cards, or move content between cards.",classifyExamples:["break this into two cards","split this up as multiple slides","put the gallery on the next card"],apology:"Sorry, I can't split cards or move things between them yet. However, you can split cards yourself by typing /split inside a card."}),eI=new ep({key:"NEW_DECK",description:"Create a whole new deck",classifyExamples:["i need a presentation about [topic]","write a whole document about animal","make me a landing page about this"],apology:"To make a new deck, go back to the home screen and click New with AI."}),eb=new ep({key:"CHANGE_MULTIPLE_CARDS",description:"Make changes across multiple cards at once",classifyExamples:["I want this entire deck to be summarized","combine the cards together in one","make the whole doc sound more professional","make the deck more consistent","translate all of the cards","change the font for the whole deck"],apology:"Sorry, I can only change one card at a time right now."}),ew=new ep({key:"CHANGE_ANOTHER_CARDS",description:"Make changes for an unselected card",classifyExamples:["make the same change for the next card","do the same thing for the other cards","change the last card too","make this layout match the layout of the previous card","copy the first section from the last card here"],apology:"Sorry, I can only look at one card at a time right now. You can have me edit other cards by clicking on them."}),ev=new ep({key:"ADD_VIDEO",description:"Add a video or replace an existing video",classifyExamples:["add a youtube video about scrum","find videos of cats","i need more videos"],apology:"Sorry, I can't search for videos yet. You can embed video by copying the URL and pasting it into the card directly."}),eC=new ep({key:"ADD_FOOTNOTE",description:"Add a footnote to a card, or change footnotes",classifyExamples:["add a biography for him in a footnote","put the details into footnotes"],apology:"Sorry, I haven't learned to add footnotes yet. You can make footnotes by highlighting text and clicking the footnote button in the menu."}),ej=new ep({key:"MOVE_CARD",description:"Move a card to a different position in the deck",classifyExamples:["shift the slide to the top","move this card to the bottom"],apology:"Sorry, I haven't learned to move cards yet. You can move them by hovering on the table of contents on the left side of the screen and dragging them around."}),eR=new ep({key:"ADD_CHART",description:"Add a chart, diagram, or graph",classifyExamples:["put this information into a scatter plot","add a card about market share using a pie chart","i need to display this as a flow chart","create a diagram illustrating the interactions and relationships","can you change the card to have a line graph","turn this into a gantt chart","could you do this as a funnel diagram"],apology:"Sorry, Gamma doesn't support charts yet. You can paste in images of charts from other tools, or type /diagram in the editor to draw your own."}),eS=[eu,eh,ef,ey,ex,ek,eI,eb,ew,ev,eC,ej,eR,new ep({key:"ANIMATION",description:"Add animations to a card or edit animations",classifyExamples:["animate transitions","make the text appear one by one","fade in the images","make the bullets fly in"],apology:'Sorry, Gamma doesn\'t support custom animations yet. You can animate line by line by going into Present mode and pressing S for "spotlight".'}),new ep({key:"FOLLOW_LINK",description:"Read content from an external website",classifyExamples:["go to this website and add the content to this card http://www.example.com/","here is his linkedin page now add the details https://www.linkedin.com/...","add the images from https://medium.com/posts/2022/9/6/..."],apology:"Sorry, I'm not able to open links and read the content."}),new ep({key:"SHADOW",description:"Add or edit shadow for an element or text",classifyExamples:["add a drop shadow to the image","make the text have a shadow","make the button have a darker shadow"],apology:"Sorry, I'm not able to add custom shadows yet."})],eE=e=>eS.find(t=>t.key===e),eA=e=>!!eE(e),eT=new n.F({variables:["message","taskList","ackExamples","html","cardHtml"],systemPromptOperation:o.mc.ClassifySystem,userPromptOperation:o.mc.ClassifyUser,params:{maxTokens:100,temperature:.2}}),eM=[...ed,...eS,...u,...j],e_="\uD83D\uDE14 Sorry, I didn't understand your request. Could you please try asking a different way?",eD=async e=>{let t,{message:a,context:s,history:r,provider:i}=e,{ackExamples:n,taskList:l,enabledTasks:d}=eF(eM,s.editorContext),m=k.of.get("aiChatJsx"),g=eP(r),p={message:a,ackExamples:n,taskList:l,html:s.editorContext.defaultRange.html,cardHtml:s.editorContext.card.html},u=eT.prepare({variables:p,params:{provider:i},history:g});console.debug("[AIChat classify] Getting classification",{classifyHistory:g,input:u});let h=await (0,y.wo)(u);if(m){let{promise:e}=(0,x.i4)({variables:{message:p.message,html:p.html,cardHtml:p.cardHtml,taskList:p.taskList,ackExamples:p.ackExamples,history:g.map(e=>({role:e.role===o.VDI.Assistant?"assistant":"user",content:e.content||""}))},interactionId:s.interactionId,workspaceId:s.workspaceId,promptKey:"ChatClassify",opts:{timeout:k.of.get("aiRequestTimeouts").classify}});t=await e}else t=await (0,c.U)(h,s.interactionId,{timeout:k.of.get("aiRequestTimeouts").classify});let f=eO(t,d);return(f||(console.debug("Failed classification, trying again...",{resp:t,parsedResp:f}),f=eO(t=await (0,c.U)(u,s.interactionId),d)),f)?(console.debug("[AIChat classify] Got classification",{resp:t,parsedResp:f}),f):{type:"UNKNOWN",classification:"UNKNOWN",ack:e_,resp:t||""}},eN="Ok, I'll get right on it.",eO=(e,t)=>{var a;if(!e)return;let s=e.split("\n"),r=null===(a=s[0])||void 0===a?void 0:a.trim().toUpperCase();if(!t.find(e=>e.key===r))return;let i=s[1];return{classification:r.trim(),ack:i.includes(r.trim())?eN:i||("UNKNOWN"!==r?eN:e_),resp:e,type:"CLASSIFICATION"}},eF=(e,t)=>{let a=e.filter(e=>!t||!e.checkEnabled||e.checkEnabled(t));return{taskList:a.map(e=>{var t;return"".concat(e.key,": ").concat(e.description,"\n").concat(null===(t=e.classifyExamples)||void 0===t?void 0:t.map(e=>"- ".concat(e)).join("\n"))}).join("\n\n"),ackExamples:a.filter(e=>e.classifyExamples&&e.classifyExamples.length>0&&e.classifyReply).map(e=>"Request:\n".concat(e.classifyExamples[0],"\nResponse:\n").concat([e.key,e.classifyReply].join("\n"))).join("\n\n"),enabledTasks:a}},eP=e=>e.slice(-7).map(e=>"User"===e.from?{role:o.VDI.User,content:e.message}:e.isClassification?{role:o.VDI.Assistant,content:e.resp}:null).filter(e=>!!e);var eL=a(24939),eU=a(50047),eG=a(88808),ez=a(71197),eq=a(19717),eH=a(64225),eV=a(26768),eB=a(52014),eW=a(56897);let eJ=e=>{let{editor:t,addMessage:a,getMessageHistory:n}=e,o=(0,eH.CU)(),l=(0,eB.O)(),{hasEnoughCreditsToChat:c}=(0,ez.B9)(),d=(0,eL.B)(),m=(0,eU.VG)(),g=(0,eH.jL)(),p=(0,eH.GV)(eW.Hw),u=(0,r.useCallback)(e=>{g((0,eW.Lx)(e))},[g]);return{sendMessage:(0,r.useCallback)(async e=>{var r;let g,p,y;let{message:x}=e;if(!t)return;let b=(0,I.$F)(),w=null===(r=(0,v.bs)(t.gammaOrgId))||void 0===r?void 0:r.id;try{g=(0,eV.s)(t,o),p={interactionId:b,startTime:performance.now(),message:x,editorContext:g,docId:t.gammaDocId,workspaceId:w},console.debug("[AIChat] starting interaction",p);let e=n();a({from:"User",type:"text",message:x,interactionId:b});let s=k.of.get("aiChatJsx")?"amazon":m;if(l.trackRequestSent(p,s),!c)return;u("classifying");let r=await eD({message:x,context:p,history:e,provider:m});if(l.trackClassification({taskContext:p,classification:r.classification}),u("fetching"),console.debug("[AIChat] Starting task",{taskContext:p,classification:r.classification,history:e}),"UNKNOWN"===r.type)a({from:"Designer",type:"text",message:r.ack,resp:r.resp,isClassification:!0,interactionId:b}),l.trackRequestComplete({taskContext:p,outputMessage:r.ack});else if(f(r.classification)){let s=h(r.classification);await s.run({editor:t,addMessage:a,context:p,classificationResult:r,history:e,trackFns:l,themeModificationController:d,provider:m})}else if(eA(r.classification)){let s=eE(r.classification);await s.run({editor:t,context:p,addMessage:a,classificationResult:r,history:e,trackFns:l,themeModificationController:d,provider:m})}else if(eg(r.classification)){a({from:"Designer",type:"text",message:r.ack||"Sure, let me see what I can do...",resp:r.resp,isClassification:!0});let e=n(),s=em(r.classification);await s.run({editor:t,context:p,addMessage:a,classificationResult:r,history:e,trackFns:l,themeModificationController:d,provider:m}),y="chatSuggestion"}else if(S(r.classification)){a({from:"Designer",type:"text",message:r.ack||"Sure, let me see what I can do...",resp:r.resp,isClassification:!0});let s=R(r.classification);await s.run({editor:t,context:p,addMessage:a,classificationResult:r,history:e,trackFns:l,themeModificationController:d,provider:m}),y="generateImage"}}catch(t){console.log("[AIChat.sendMessage] ERROR: ".concat(t.message,"}"),{err:t,taskContext:p});let e="Sorry, something unexpected happened. Please try again.";if(t instanceof i.Bb){let s=t.opts.chatMessage||e;a({from:"Designer",type:"text",message:s,resp:t.opts.resp,interactionId:b}),l.trackRequestError({errorName:t.name,interactionId:b,outputMessage:s,errorMessage:t.message,resp:t.opts.resp})}else s.Cp(t),a({from:"Designer",type:"text",message:e,interactionId:b}),l.trackRequestError({errorName:t.name,interactionId:b,outputMessage:e,errorMessage:t.message,errorCode:(0,eG.vI)(t)[0]})}y&&(0,eq.w)(y,void 0,b),u("idle")},[t,o,n,a,l,c,d,m,u]),status:p}}}}]);
//# sourceMappingURL=6113-5b2038508828b7d6.js.map